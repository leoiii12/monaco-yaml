{"version":3,"sources":["languageFeatures.ts"],"names":[],"mappings":"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","file":"languageFeatures.js","sourceRoot":"..\\src","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n'use strict';\r\n\r\nimport { LanguageServiceDefaultsImpl } from './monaco.contribution';\r\nimport { YAMLWorker } from './yamlWorker';\r\n\r\nimport * as ls from 'vscode-languageserver-types';\r\n\r\nimport Uri = monaco.Uri;\r\nimport Position = monaco.Position;\r\nimport Range = monaco.Range;\r\nimport IRange = monaco.IRange;\r\nimport Thenable = monaco.Thenable;\r\nimport CancellationToken = monaco.CancellationToken;\r\nimport IDisposable = monaco.IDisposable;\r\n\r\nexport type WorkerAccessor = (...more: Uri[]) => Thenable<YAMLWorker>;\r\n\r\n// --- diagnostics --- ---\r\n\r\nexport class DiagnosticsAdapter {\r\n  private _disposables: IDisposable[] = [];\r\n  private _listener: { [uri: string]: IDisposable } = Object.create(null);\r\n\r\n  constructor(\r\n    private _languageId: string,\r\n    private _worker: WorkerAccessor,\r\n    defaults: LanguageServiceDefaultsImpl\r\n  ) {\r\n    const onModelAdd = (model: monaco.editor.IModel): void => {\r\n      const modeId = model.getModeId();\r\n      if (modeId !== this._languageId) {\r\n        return;\r\n      }\r\n\r\n      let handle: NodeJS.Timer;\r\n      this._listener[model.uri.toString()] = model.onDidChangeContent(() => {\r\n        clearTimeout(handle);\r\n        handle = setTimeout(() => this._doValidate(model.uri, modeId), 500);\r\n      });\r\n\r\n      this._doValidate(model.uri, modeId);\r\n    };\r\n\r\n    const onModelRemoved = (model: monaco.editor.IModel): void => {\r\n      monaco.editor.setModelMarkers(model, this._languageId, []);\r\n      const uriStr = model.uri.toString();\r\n      const listener = this._listener[uriStr];\r\n      if (listener) {\r\n        listener.dispose();\r\n        delete this._listener[uriStr];\r\n      }\r\n    };\r\n\r\n    this._disposables.push(monaco.editor.onDidCreateModel(onModelAdd));\r\n    this._disposables.push(\r\n      monaco.editor.onWillDisposeModel(model => {\r\n        onModelRemoved(model);\r\n        this._resetSchema(model.uri);\r\n      })\r\n    );\r\n    this._disposables.push(\r\n      monaco.editor.onDidChangeModelLanguage(event => {\r\n        onModelRemoved(event.model);\r\n        onModelAdd(event.model);\r\n        this._resetSchema(event.model.uri);\r\n      })\r\n    );\r\n\r\n    this._disposables.push(\r\n      defaults.onDidChange(_ => {\r\n        monaco.editor.getModels().forEach(model => {\r\n          if (model.getModeId() === this._languageId) {\r\n            onModelRemoved(model);\r\n            onModelAdd(model);\r\n          }\r\n        });\r\n      })\r\n    );\r\n\r\n    this._disposables.push({\r\n      dispose: () => {\r\n        monaco.editor.getModels().forEach(onModelRemoved);\r\n        for (const key in this._listener) {\r\n          this._listener[key].dispose();\r\n        }\r\n      },\r\n    });\r\n\r\n    monaco.editor.getModels().forEach(onModelAdd);\r\n  }\r\n\r\n  public dispose(): void {\r\n    this._disposables.forEach(d => d && d.dispose());\r\n    this._disposables = [];\r\n  }\r\n\r\n  private _resetSchema(resource: Uri): void {\r\n    this._worker().then(worker => {\r\n      worker.resetSchema(resource.toString());\r\n    });\r\n  }\r\n\r\n  private _doValidate(resource: Uri, languageId: string): void {\r\n    this._worker(resource)\r\n      .then(worker => {\r\n        return worker.doValidation(resource.toString()).then(diagnostics => {\r\n          const markers = diagnostics.map(d => toDiagnostics(resource, d));\r\n          const model = monaco.editor.getModel(resource);\r\n          if (model.getModeId() === languageId) {\r\n            monaco.editor.setModelMarkers(model, languageId, markers);\r\n          }\r\n        });\r\n      })\r\n      .then(undefined, err => {\r\n        console.error(err);\r\n      });\r\n  }\r\n}\r\n\r\nfunction toSeverity(lsSeverity: number): monaco.MarkerSeverity {\r\n  switch (lsSeverity) {\r\n    case ls.DiagnosticSeverity.Error:\r\n      return monaco.MarkerSeverity.Error;\r\n    case ls.DiagnosticSeverity.Warning:\r\n      return monaco.MarkerSeverity.Warning;\r\n    case ls.DiagnosticSeverity.Information:\r\n      return monaco.MarkerSeverity.Info;\r\n    case ls.DiagnosticSeverity.Hint:\r\n      return monaco.MarkerSeverity.Hint;\r\n    default:\r\n      return monaco.MarkerSeverity.Info;\r\n  }\r\n}\r\n\r\nfunction toDiagnostics(\r\n  resource: Uri,\r\n  diag: ls.Diagnostic\r\n): monaco.editor.IMarkerData {\r\n  const code =\r\n    typeof diag.code === 'number' ? String(diag.code) : (diag.code as string);\r\n\r\n  return {\r\n    severity: toSeverity(diag.severity),\r\n    startLineNumber: diag.range.start.line + 1,\r\n    startColumn: diag.range.start.character + 1,\r\n    endLineNumber: diag.range.end.line + 1,\r\n    endColumn: diag.range.end.character + 1,\r\n    message: diag.message,\r\n    code,\r\n    source: diag.source,\r\n  };\r\n}\r\n\r\n// --- completion ------\r\n\r\nfunction fromPosition(position: Position): ls.Position {\r\n  if (!position) {\r\n    return void 0;\r\n  }\r\n  return { character: position.column - 1, line: position.lineNumber - 1 };\r\n}\r\n\r\nfunction fromRange(range: IRange): ls.Range {\r\n  if (!range) {\r\n    return void 0;\r\n  }\r\n  return {\r\n    start: {\r\n      line: range.startLineNumber - 1,\r\n      character: range.startColumn - 1,\r\n    },\r\n    end: { line: range.endLineNumber - 1, character: range.endColumn - 1 },\r\n  };\r\n}\r\nfunction toRange(range: ls.Range): Range {\r\n  if (!range) {\r\n    return void 0;\r\n  }\r\n  return new Range(\r\n    range.start.line + 1,\r\n    range.start.character + 1,\r\n    range.end.line + 1,\r\n    range.end.character + 1\r\n  );\r\n}\r\n\r\nfunction toCompletionItemKind(\r\n  kind: number\r\n): monaco.languages.CompletionItemKind {\r\n  const mItemKind = monaco.languages.CompletionItemKind;\r\n\r\n  switch (kind) {\r\n    case ls.CompletionItemKind.Text:\r\n      return mItemKind.Text;\r\n    case ls.CompletionItemKind.Method:\r\n      return mItemKind.Method;\r\n    case ls.CompletionItemKind.Function:\r\n      return mItemKind.Function;\r\n    case ls.CompletionItemKind.Constructor:\r\n      return mItemKind.Constructor;\r\n    case ls.CompletionItemKind.Field:\r\n      return mItemKind.Field;\r\n    case ls.CompletionItemKind.Variable:\r\n      return mItemKind.Variable;\r\n    case ls.CompletionItemKind.Class:\r\n      return mItemKind.Class;\r\n    case ls.CompletionItemKind.Interface:\r\n      return mItemKind.Interface;\r\n    case ls.CompletionItemKind.Module:\r\n      return mItemKind.Module;\r\n    case ls.CompletionItemKind.Property:\r\n      return mItemKind.Property;\r\n    case ls.CompletionItemKind.Unit:\r\n      return mItemKind.Unit;\r\n    case ls.CompletionItemKind.Value:\r\n      return mItemKind.Value;\r\n    case ls.CompletionItemKind.Enum:\r\n      return mItemKind.Enum;\r\n    case ls.CompletionItemKind.Keyword:\r\n      return mItemKind.Keyword;\r\n    case ls.CompletionItemKind.Snippet:\r\n      return mItemKind.Snippet;\r\n    case ls.CompletionItemKind.Color:\r\n      return mItemKind.Color;\r\n    case ls.CompletionItemKind.File:\r\n      return mItemKind.File;\r\n    case ls.CompletionItemKind.Reference:\r\n      return mItemKind.Reference;\r\n  }\r\n  return mItemKind.Property;\r\n}\r\n\r\nfunction fromCompletionItemKind(\r\n  kind: monaco.languages.CompletionItemKind\r\n): ls.CompletionItemKind {\r\n  const mItemKind = monaco.languages.CompletionItemKind;\r\n\r\n  switch (kind) {\r\n    case mItemKind.Text:\r\n      return ls.CompletionItemKind.Text;\r\n    case mItemKind.Method:\r\n      return ls.CompletionItemKind.Method;\r\n    case mItemKind.Function:\r\n      return ls.CompletionItemKind.Function;\r\n    case mItemKind.Constructor:\r\n      return ls.CompletionItemKind.Constructor;\r\n    case mItemKind.Field:\r\n      return ls.CompletionItemKind.Field;\r\n    case mItemKind.Variable:\r\n      return ls.CompletionItemKind.Variable;\r\n    case mItemKind.Class:\r\n      return ls.CompletionItemKind.Class;\r\n    case mItemKind.Interface:\r\n      return ls.CompletionItemKind.Interface;\r\n    case mItemKind.Module:\r\n      return ls.CompletionItemKind.Module;\r\n    case mItemKind.Property:\r\n      return ls.CompletionItemKind.Property;\r\n    case mItemKind.Unit:\r\n      return ls.CompletionItemKind.Unit;\r\n    case mItemKind.Value:\r\n      return ls.CompletionItemKind.Value;\r\n    case mItemKind.Enum:\r\n      return ls.CompletionItemKind.Enum;\r\n    case mItemKind.Keyword:\r\n      return ls.CompletionItemKind.Keyword;\r\n    case mItemKind.Snippet:\r\n      return ls.CompletionItemKind.Snippet;\r\n    case mItemKind.Color:\r\n      return ls.CompletionItemKind.Color;\r\n    case mItemKind.File:\r\n      return ls.CompletionItemKind.File;\r\n    case mItemKind.Reference:\r\n      return ls.CompletionItemKind.Reference;\r\n  }\r\n  return ls.CompletionItemKind.Property;\r\n}\r\n\r\nfunction toTextEdit(textEdit: ls.TextEdit): monaco.editor.ISingleEditOperation {\r\n  if (!textEdit) {\r\n    return void 0;\r\n  }\r\n  return {\r\n    range: toRange(textEdit.range),\r\n    text: textEdit.newText,\r\n  };\r\n}\r\n\r\nexport class CompletionAdapter\r\n  implements monaco.languages.CompletionItemProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public get triggerCharacters(): string[] {\r\n    return [' ', ':'];\r\n  }\r\n\r\n  public provideCompletionItems(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    position: Position,\r\n    context: monaco.languages.CompletionContext,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.languages.CompletionList> {\r\n    const wordInfo = model.getWordUntilPosition(position);\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource)\r\n      .then(worker => {\r\n        return worker.doComplete(resource.toString(), fromPosition(position));\r\n      })\r\n      .then(info => {\r\n        if (!info) {\r\n          return;\r\n        }\r\n        const items: monaco.languages.CompletionItem[] = info.items.map(\r\n          entry => {\r\n            const item: monaco.languages.CompletionItem = {\r\n              label: entry.label,\r\n              insertText: entry.insertText || entry.label,\r\n              sortText: entry.sortText,\r\n              filterText: entry.filterText,\r\n              documentation: entry.documentation,\r\n              detail: entry.detail,\r\n              kind: toCompletionItemKind(entry.kind),\r\n              range: toRange(entry.textEdit.range),\r\n            };\r\n            if (entry.textEdit) {\r\n              item.insertText = entry.textEdit.newText;\r\n            }\r\n            if (entry.additionalTextEdits) {\r\n              item.additionalTextEdits = entry.additionalTextEdits.map(\r\n                toTextEdit\r\n              );\r\n            }\r\n            if (entry.insertTextFormat === ls.InsertTextFormat.Snippet) {\r\n              item.insertTextRules =\r\n                monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet;\r\n            }\r\n            return item;\r\n          }\r\n        );\r\n\r\n        return {\r\n          isIncomplete: info.isIncomplete,\r\n          suggestions: items,\r\n        };\r\n      });\r\n  }\r\n}\r\n\r\nfunction isMarkupContent(thing: any): thing is ls.MarkupContent {\r\n  return (\r\n    thing &&\r\n    typeof thing === 'object' &&\r\n    typeof (thing as ls.MarkupContent).kind === 'string'\r\n  );\r\n}\r\n\r\nfunction toMarkdownString(\r\n  entry: ls.MarkupContent | ls.MarkedString\r\n): monaco.IMarkdownString {\r\n  if (typeof entry === 'string') {\r\n    return {\r\n      value: entry,\r\n    };\r\n  }\r\n  if (isMarkupContent(entry)) {\r\n    if (entry.kind === 'plaintext') {\r\n      return {\r\n        value: entry.value.replace(/[\\\\`*_{}[\\]()#+\\-.!]/g, '\\\\$&'),\r\n      };\r\n    }\r\n    return {\r\n      value: entry.value,\r\n    };\r\n  }\r\n\r\n  return { value: '```' + entry.language + '\\n' + entry.value + '\\n```\\n' };\r\n}\r\n\r\nfunction toMarkedStringArray(\r\n  contents: ls.MarkupContent | ls.MarkedString | ls.MarkedString[]\r\n): monaco.IMarkdownString[] {\r\n  if (!contents) {\r\n    return void 0;\r\n  }\r\n  if (Array.isArray(contents)) {\r\n    return contents.map(toMarkdownString);\r\n  }\r\n  return [toMarkdownString(contents)];\r\n}\r\n\r\n// --- hover ------\r\n\r\nexport class HoverAdapter implements monaco.languages.HoverProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public provideHover(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    position: Position,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.languages.Hover> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource)\r\n      .then(worker => {\r\n        return worker.doHover(resource.toString(), fromPosition(position));\r\n      })\r\n      .then(info => {\r\n        if (!info) {\r\n          return;\r\n        }\r\n        return {\r\n          range: toRange(info.range),\r\n          contents: toMarkedStringArray(info.contents),\r\n        } as monaco.languages.Hover;\r\n      });\r\n  }\r\n}\r\n\r\n// --- document symbols ------\r\n\r\nfunction toSymbolKind(kind: ls.SymbolKind): monaco.languages.SymbolKind {\r\n  const mKind = monaco.languages.SymbolKind;\r\n\r\n  switch (kind) {\r\n    case ls.SymbolKind.File:\r\n      return mKind.Array;\r\n    case ls.SymbolKind.Module:\r\n      return mKind.Module;\r\n    case ls.SymbolKind.Namespace:\r\n      return mKind.Namespace;\r\n    case ls.SymbolKind.Package:\r\n      return mKind.Package;\r\n    case ls.SymbolKind.Class:\r\n      return mKind.Class;\r\n    case ls.SymbolKind.Method:\r\n      return mKind.Method;\r\n    case ls.SymbolKind.Property:\r\n      return mKind.Property;\r\n    case ls.SymbolKind.Field:\r\n      return mKind.Field;\r\n    case ls.SymbolKind.Constructor:\r\n      return mKind.Constructor;\r\n    case ls.SymbolKind.Enum:\r\n      return mKind.Enum;\r\n    case ls.SymbolKind.Interface:\r\n      return mKind.Interface;\r\n    case ls.SymbolKind.Function:\r\n      return mKind.Function;\r\n    case ls.SymbolKind.Variable:\r\n      return mKind.Variable;\r\n    case ls.SymbolKind.Constant:\r\n      return mKind.Constant;\r\n    case ls.SymbolKind.String:\r\n      return mKind.String;\r\n    case ls.SymbolKind.Number:\r\n      return mKind.Number;\r\n    case ls.SymbolKind.Boolean:\r\n      return mKind.Boolean;\r\n    case ls.SymbolKind.Array:\r\n      return mKind.Array;\r\n  }\r\n  return mKind.Function;\r\n}\r\n\r\nexport class DocumentSymbolAdapter\r\n  implements monaco.languages.DocumentSymbolProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public provideDocumentSymbols(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.languages.DocumentSymbol[]> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource)\r\n      .then(worker => worker.findDocumentSymbols(resource.toString()))\r\n      .then(items => {\r\n        if (!items) {\r\n          return;\r\n        }\r\n        return items.map(item => ({\r\n          name: item.name,\r\n          detail: '',\r\n          containerName: item.containerName,\r\n          kind: toSymbolKind(item.kind),\r\n          range: toRange(item.location.range),\r\n          selectionRange: toRange(item.location.range),\r\n        }));\r\n      });\r\n  }\r\n}\r\n\r\nfunction fromFormattingOptions(\r\n  options: monaco.languages.FormattingOptions\r\n): ls.FormattingOptions {\r\n  return {\r\n    tabSize: options.tabSize,\r\n    insertSpaces: options.insertSpaces,\r\n  };\r\n}\r\n\r\nexport class DocumentFormattingEditProvider\r\n  implements monaco.languages.DocumentFormattingEditProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public provideDocumentFormattingEdits(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    options: monaco.languages.FormattingOptions,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.editor.ISingleEditOperation[]> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource).then(worker => {\r\n      return worker\r\n        .format(resource.toString(), null, fromFormattingOptions(options))\r\n        .then(edits => {\r\n          if (!edits || edits.length === 0) {\r\n            return;\r\n          }\r\n          return edits.map(toTextEdit);\r\n        });\r\n    });\r\n  }\r\n}\r\n\r\nexport class DocumentRangeFormattingEditProvider\r\n  implements monaco.languages.DocumentRangeFormattingEditProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public provideDocumentRangeFormattingEdits(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    range: Range,\r\n    options: monaco.languages.FormattingOptions,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.editor.ISingleEditOperation[]> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource).then(worker => {\r\n      return worker\r\n        .format(\r\n          resource.toString(),\r\n          fromRange(range),\r\n          fromFormattingOptions(options)\r\n        )\r\n        .then(edits => {\r\n          if (!edits || edits.length === 0) {\r\n            return;\r\n          }\r\n          return edits.map(toTextEdit);\r\n        });\r\n    });\r\n  }\r\n}\r\n\r\nexport class DocumentColorAdapter\r\n  implements monaco.languages.DocumentColorProvider {\r\n  constructor(private _worker: WorkerAccessor) {}\r\n\r\n  public provideDocumentColors(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.languages.IColorInformation[]> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource)\r\n      .then(worker => worker.findDocumentColors(resource.toString()))\r\n      .then(infos => {\r\n        if (!infos) {\r\n          return;\r\n        }\r\n        return infos.map(item => ({\r\n          color: item.color,\r\n          range: toRange(item.range),\r\n        }));\r\n      });\r\n  }\r\n\r\n  public provideColorPresentations(\r\n    model: monaco.editor.IReadOnlyModel,\r\n    info: monaco.languages.IColorInformation,\r\n    token: CancellationToken\r\n  ): Thenable<monaco.languages.IColorPresentation[]> {\r\n    const resource = model.uri;\r\n\r\n    return this._worker(resource)\r\n      .then(worker =>\r\n        worker.getColorPresentations(\r\n          resource.toString(),\r\n          info.color,\r\n          fromRange(info.range)\r\n        )\r\n      )\r\n      .then(presentations => {\r\n        if (!presentations) {\r\n          return;\r\n        }\r\n        return presentations.map(presentation => {\r\n          const item: monaco.languages.IColorPresentation = {\r\n            label: presentation.label,\r\n          };\r\n          if (presentation.textEdit) {\r\n            item.textEdit = toTextEdit(presentation.textEdit);\r\n          }\r\n          if (presentation.additionalTextEdits) {\r\n            item.additionalTextEdits = presentation.additionalTextEdits.map(\r\n              toTextEdit\r\n            );\r\n          }\r\n          return item;\r\n        });\r\n      });\r\n  }\r\n}\r\n"]}